# 2.6 ä¸»é¢˜ã€æµ‹è¯•ã€æ ¼å¼åŒ–

> åŸæ–‡åœ°å€ï¼š [https://juejin.cn/post/6972180649625157645](https://juejin.cn/post/6972180649625157645)

æœ¬æ–‡ä»‹ä¸»é¢˜æ„å»ºã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ä»£ç è´¨é‡æ£€æŸ¥ã€ç±»å‹å£°æ˜ã€‚

## é¡¹ç›®ä¸»é¢˜

### ğŸ“ packages/theme-chalk

é¡¹ç›®ä¸»é¢˜ `theme-chalk` æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®,é€šè¿‡ `gulp` æ‰“åŒ…æ„å»ºç”Ÿæˆï¼Œæ”¯æŒå•ç‹¬å‘å¸ƒã€‚ [ElementUI/theme-chalk ä»“åº“åœ°å€](https://github.com/ElementUI/theme-chalk)

`packages/theme-chalk` ä¸‹æ”¾æœ‰å­—ä½“æ–‡ä»¶ï¼Œscss ç›¸å…³å˜é‡ã€mixin åŠå…¬å…±æ ·å¼è®¾ç½®ï¼Œå„ UI ç»„ä»¶å¯¹åº”çš„ scss æ–‡ä»¶ã€‚é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ ğŸ‘‡ï¼š

```bash
â”œâ”€gulpfile.js               # å¸®åŠ©gulpå®ç°è‡ªåŠ¨åŒ–ç®¡ç†é¡¹ç›®åŠŸèƒ½
â”œâ”€package.json
â”œâ”€src
|  â”œâ”€reset.scss             # é‡ç½®æµè§ˆå™¨çš„é»˜è®¤å±æ€§
|  â”œâ”€index.scss             # æ ·å¼å…¥å£æ–‡ä»¶
|  â”œâ”€base.scss              # åŸºç¡€ å¼•å…¥åŠ¨ç”» ã€å›¾æ ‡æ ·å¼
|  â”œâ”€icon.scss              # å›¾æ ‡æ ·å¼
...
|  â”œâ”€button.scss            # ç»„ä»¶å¯¹åº”å•ç‹¬çš„scssæ–‡ä»¶
|  â”œâ”€upload.scss            # ç»„ä»¶å¯¹åº”å•ç‹¬çš„scssæ–‡ä»¶
...
|  â”œâ”€mixins                 # æ··å…¥(mixin)å®šä¹‰
|  |   â”œâ”€config.scss        # å˜é‡
|  |   â”œâ”€function.scss      # è‡ªå®šä¹‰å‡½æ•° @fuction
|  |   â”œâ”€mixins.scss        # æ”¯æŒæ¥æ”¶å‚æ•°
|  |   â”œâ”€utils.scss         # å…¬å…±æ ·å¼
|  |   â””button.scss         # æŒ‰é’®å…¬å…±æ ·å¼
|  â”œâ”€fonts  # å­—ä½“å›¾æ ‡
|  â”œâ”€date-picker            # æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨æ ·å¼
|  â”œâ”€common
|  |   â”œâ”€transition.scss    # åŠ¨ç”»
|  |   â””var.scss            # ä¸»é¢˜sasså˜é‡
â”œâ”€lib                       # æ‰“åŒ…è¾“å‡ºç›®å½•
```

### @mixin ä¸ @include

`@mixin` æŒ‡ä»¤å…è®¸æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¯ä»¥åœ¨æ•´ä¸ªæ ·å¼è¡¨ä¸­é‡å¤ä½¿ç”¨çš„æ ·å¼ã€‚

`@include` æŒ‡ä»¤å¯ä»¥å°†æ··å…¥ï¼ˆmixinï¼‰å¼•å…¥åˆ°æ–‡æ¡£ä¸­ã€‚

æ··å…¥(mixin)é€šè¿‡ @mixin æŒ‡ä»¤æ¥å®šä¹‰ã€‚åˆ›å»ºä¸€ä¸ªåä¸º "important-text" çš„æ··å…¥ï¼š

```css
@mixin important-text {
  color: red;
  font-size: 25px;
  font-weight: bold;
  border: 1px solid blue;
}
```

@include æŒ‡ä»¤å¯ç”¨äºåŒ…å«ä¸€æ··å…¥,åŒ…å« important-text æ··å…¥ä»£ç å¦‚ä¸‹ï¼š

![carbon (48).png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f86f4543e7cd46889803c8ed20fcb045\~tplv-k3u1fbpfcp-watermark.image)

```css
/* @includeå®ä¾‹ */
.danger {
  @include important-text;
  background-color: green;
}
å°†ä»¥ä¸Šä»£ç è½¬æ¢ä¸º CSS ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

/* è½¬æ¢ä¸º CSS ä»£ç  */
.danger {
  color: red;
  font-size: 25px;
  font-weight: bold;
  border: 1px solid blue;
  background-color: green;
}
```

### ä¸»é¢˜æ„å»º

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/557bf008c05644cb90fb32463ffe14e8\~tplv-k3u1fbpfcp-watermark.image)

#### 1ï¸âƒ£ ç”Ÿæˆå…¥å£æ–‡ä»¶

`build/bin/gen-cssfile` æ‰¾åˆ° `components.json`ï¼Œ è·å–ç»„ä»¶åˆ—è¡¨ï¼Œæ‰¾åˆ°`packages/theme-chalk/src`ç›®å½•ä¸‹å¯¹åº”çš„å„ç»„ä»¶çš„ `component-name.scss` æ–‡ä»¶ï¼Œä»¥`@import "./component-name.scss"`çš„å½¢å¼ï¼Œå†™å…¥`packages/theme-chalk/index.scss`æ–‡ä»¶-æ ·å¼æ€»å…¥å£æ–‡ä»¶ã€‚è‹¥æ˜¯ç»„ä»¶å¯¹åº”çš„æ ·å¼ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºé—æ¼çš„æ ·å¼æ–‡ä»¶ã€‚

#### 2ï¸âƒ£ æ„å»ºä¸»é¢˜

`gulp`æ˜¯ä¸€ç§åŸºäºæµ(stream)çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œ`gulpfile.js` å®šä¹‰ä¸¤ä¸ªä»»åŠ¡(task):

* å°†`packages/theme-chalk/src`ç›®å½•ä¸‹çš„ scss æ–‡ä»¶è½¬æ¢æˆ css æ–‡ä»¶ï¼Œè¾“å‡ºè‡³`packages/theme-chalk/src/lib`ç›®å½•ä¸‹;
* å°†`packages/theme-chalk/src/fonts`ç›®å½•ä¸‹çš„å­—ä½“å›¾æ ‡æ–‡ä»¶å‹ç¼©å¤„ç†ï¼Œè¾“å‡ºè‡³ `packages/theme-chalk/src/lib/fonts` ç›®å½•ä¸‹ã€‚

![carbon (50).png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d27799bc66554e6b89a1783278a9e206\~tplv-k3u1fbpfcp-watermark.image)

#### 3ï¸âƒ£ æ‹·è´è‡³ lib/theme-chalk ä¸‹

é€šè¿‡`cp-cli`ï¼Œå°†`packages/theme-chalk/src/lib`ç›®å½•ä¸‹æ–‡ä»¶æ‹·è´è‡³`lib/theme-chalk`ç›®å½•ä¸‹ã€‚

## é¡¹ç›®æµ‹è¯•

### test\ssr\require.test.js

SSR å¼•å…¥ç±»åº“(require)æµ‹è¯•, `build\release.sh`æ–‡ä»¶æ‰§è¡Œ `node test/ssr/require.test.js` å‘½ä»¤ã€‚

```js
const path = require("path");

try {
  process.env.VUE_ENV = "server";
  require(path.join(process.env.PWD, "./lib/index"));
  console.log("SSR require test PASS");
} catch (e) {
  console.error("SSR require test error");
  throw Error(e);
}
```

### ğŸ“ test/unit å•å…ƒæµ‹è¯•

é¡¹ç›®é€šè¿‡æ‰§è¡Œ `npm run test` `npm run test:watch` è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œä½¿ç”¨å¦‚ä¸‹æŠ€æœ¯ï¼š

* `karma` æµ‹è¯•æ‰§è¡Œè¿‡ç¨‹ç®¡ç†å·¥å…·(Test Runner)ã€‚
* `Mocha` æ˜¯è¿è¡Œåœ¨ Node.js å’Œæµè§ˆå™¨ä¸Šçš„åŠŸèƒ½ä¸°å¯Œçš„ JavaScript æµ‹è¯•æ¡†æ¶ã€‚
* `Chai` æ˜¯ä¸€ä¸ªç”¨äº Node.js å’Œæµè§ˆå™¨çš„ BDD/TDD æ–­è¨€åº“ï¼Œå¯ä»¥ä¸ä»»ä½• JavaScript æµ‹è¯•æ¡†æ¶ä¾¿æ·é…å¯¹ã€‚
* `Sinon.JS` ç”¨äºå¯¹ JavaScript éš”ç¦»æµ‹è¯• spy, stub å’Œ mockã€‚é€‚ç”¨äºä»»ä½•å•å…ƒæµ‹è¯•æ¡†æ¶ã€‚

ç›®å½•ç»“æ„å¦‚ä¸‹ ğŸ‘‡ï¼š

```js
â”œâ”€index.js			    # å…¥å£æ–‡ä»¶
â”œâ”€karma.conf.js			    # karmaé…ç½®
â”œâ”€util.js                           # å…¬å…±æ–¹æ³•
â”œâ”€specs                             # æµ‹è¯•ç”¨ä¾‹
|   â”œâ”€alert.spec.js                 # æµ‹è¯•ç”¨ä¾‹è„šæœ¬ [ç»„ä»¶å].spec.js
|   â”œâ”€button.spec.js
...
...
|   â”œâ”€upload.spec.js
|   â”œâ”€util.clickoutside.spec.js
|   â””util.vue-popper.spec.js
â”œâ”€mocks                             # æ¨¡æ‹Ÿæ•°æ®
|   â””uri.js
â”œâ”€coverage                          # æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
|    â”œâ”€lcov.info                    # æŠ¥å‘Šä¿¡æ¯
|    â”œâ”€lcov-report                  # æŠ¥å‘Šç½‘ç«™
```

`karma.conf.js` æµ‹è¯•é…ç½®ä¿¡æ¯ã€‚

![carbon (95).png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f0c3e1cca384d389d5771dc8c6793da\~tplv-k3u1fbpfcp-watermark.image)

`index.js` æµ‹è¯•å…¥å£æ–‡ä»¶ï¼Œå•å…ƒæµ‹è¯•é»˜è®¤æµ‹è¯• `src` ç›®å½•ä¸‹é™¤äº† main.js ä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´æµ‹è¯•èŒƒå›´ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b479e39eb6694a91a35cdf1fe8d5a109\~tplv-k3u1fbpfcp-watermark.image)

æµ‹è¯•è„šæœ¬å‘½åæ–¹å¼ä¸º `[ç»„ä»¶å].spec.js` , ç»Ÿä¸€æ”¾åœ¨ `test/unit/specs/` ç›®å½•ä¸‹ï¼Œè¯­æ³•ç»“æ„å¦‚ä¸‹ ğŸ‘‡ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/26de93c182cc44cb93ff621db11d3b43\~tplv-k3u1fbpfcp-watermark.image)

å¦‚æœæµ‹è¯•æˆåŠŸï¼Œç»ˆç«¯è¾“å‡ºæµ‹è¯•è¦†ç›–ç‡æ¦‚è§ˆ ğŸ‘‡ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f574b69ac0c48a8975c1f5cfd51b4c5\~tplv-k3u1fbpfcp-watermark.image)

åŒæ—¶`karma-coverage` ä¼šåœ¨ `test/unit/coverage` æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡ç»“æœçš„æ¦‚è§ˆä¿¡æ¯`lcov.info`å’Œç½‘é¡µ `lcov-report/**`ã€‚

ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡ç»“æœçš„ç½‘ç«™,åœ¨æµè§ˆå…¶ä¸­æ‰“å¼€ï¼Œå†…å®¹å¦‚ä¸‹ ğŸ‘‡ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8a0e16640c2740baa6113f414245cc53\~tplv-k3u1fbpfcp-watermark.image)

## ä»£ç è´¨é‡æ£€æŸ¥

element ä½¿ç”¨äº† `eslint` è¿›è¡Œä»£ç é£æ ¼æ£€æµ‹ï¼Œè¾…åŠ©ç¼–ç è§„èŒƒæ‰§è¡Œï¼Œæœ‰æ•ˆæ§åˆ¶ä»£ç è´¨é‡ï¼Œå®ç°é¡¹ç›®ä»£ç é£æ ¼ç»Ÿä¸€ã€‚ ç¼–å†™å‘å¸ƒäº† eslint çš„æ‰©å±•è§„åˆ™é…ç½®-- [eslint-config-elemefe](https://www.npmjs.com/package/eslint-config-elemefe) ã€‚

`eslint` æ‰€èƒ½æä¾›çš„æ ¼å¼åŒ–åŠŸèƒ½å¾ˆæœ‰é™ï¼›è€Œ `prettier` åœ¨æ ¼å¼åŒ–ä»£ç æ–¹é¢å…·æœ‰æ›´å¤§ä¼˜åŠ¿ã€‚å¯ä»¥é›†æˆ `prettier` è´Ÿè´£æ ¼å¼é™åˆ¶ã€è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œè¯¦ç»†é…ç½®å‚è€ƒ[ä»£ç é£æ ¼æ£€æŸ¥å’Œæ ¼å¼åŒ–é…ç½®ï¼ˆESlint ï¼† Prettierï¼‰](https://juejin.cn/post/6951808773354684447)ã€‚

## ç±»å‹å£°æ˜

`types` ç›®å½•å­˜æ”¾ç»„ä»¶çš„ `TypeScript` å£°æ˜æ–‡ä»¶ï¼Œä»¥ `.d.ts` åç¼€ç»“å°¾ã€‚æå‡`typescript` é¡¹ç›®ä¸­å¼•å…¥ç»„ä»¶åº“çš„å¼€å‘ä½“éªŒï¼Œéœ€è¦åœ¨ `package.json` ä¸­æŒ‡å®š `typing` å±æ€§çš„å€¼ï¼Œ å£°æ˜çš„å…¥å£æ–‡ä»¶æ‰èƒ½ç”Ÿæ•ˆã€‚

```json
{
  "typings": "types/index.d.ts"
}
```

## å…³è”é˜…è¯»

ç‚¹å‡»ä»¥ä¸‹é“¾æ¥ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹æœ¬ç³»åˆ—å…¶ä»–æ–‡ç« ï¼š\
[ä¸“æ /Element 2.X æºç å­¦ä¹ ](https://juejin.cn/column/6961321064110489631)

ğŸ‘‡ é¡¹ç›®å·¥ç¨‹åŒ–ç³»åˆ—æ–‡ç« é“¾æ¥å¦‚ä¸‹ï¼Œæ¨èæŒ‰ç…§é¡ºåºé˜…è¯»æ–‡ç«  ğŸ‘‡ã€‚

1ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šé¡¹ç›®æ¦‚è§ˆã€package.jsonã€npm script](https://juejin.cn/post/6969258163136626725)\
2ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šé¡¹ç›®æ„å»ºã€MD è§£æ](https://juejin.cn/post/6969933702759940133)\
3ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šæ‰“åŒ…é…ç½®](https://juejin.cn/post/6970691644114862111/)\
4ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šå‘å¸ƒéƒ¨ç½²ã€æŒç»­é›†æˆ](https://juejin.cn/post/6971054455139598366/)\
5ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šä¸»é¢˜æ„å»ºã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ä»£ç è´¨é‡æ£€æŸ¥ã€ç±»å‹å£°æ˜](https://juejin.cn/post/6971434343516340238)\
6ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šé¡¹ç›®ç½‘ç«™](https://juejin.cn/post/6972180649625157645)\
7ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šå‘½ä»¤ä¹‹å›¾è§£](https://juejin.cn/post/6991347082552573965)
