---
description: ğŸ“¦ Webpack
---

# 2.4  æ‰“åŒ…é…ç½®

> åŸæ–‡åœ°å€ï¼š [https://juejin.cn/post/6970691644114862111/](https://juejin.cn/post/6970691644114862111/)

æœ¬æ–‡å°†ä»‹ç»é¡¹ç›®çš„æ‰“åŒ…é…ç½®åŠŸèƒ½ã€‚

> ğŸš¨ é¡¹ç›®ä¸­ `webpack` ç‰ˆæœ¬ä¸º `4.X`,æ–‡ä¸­æ¶‰åŠè¯­æ³•ã€åŠŸèƒ½ä¸æœ€æ–°ç‰ˆæœ¬`5.X`ç›¸æ¯”å­˜åœ¨å˜åŒ–ã€‚

## ğŸ“ commonjs vs commonjs2

æ¥ä¸‹æ¥é…ç½® `libraryTarget`çš„é€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°'commonjs'ã€'commonjs2'ã€‚ä¸¤è€…ä¹‹å‰çš„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

`commonjs` è§„èŒƒåªå®šä¹‰äº†`exports`ï¼Œ è€Œ `module.exports` æ˜¯`nodejs`å¯¹`commonjs`çš„å®ç°ï¼Œ è¿™ç§æ‰©å±•å®ç°ç§°ä¸º`commonjs2`ã€‚

```js
// commonjs
exports.a = "a";
exports.b = "b";

// commonjs2
module.exports = {
  a: "a",
  b: "b",
};
```

> å‚è€ƒ[https://github.com/webpack/webpack/issues/1114](https://github.com/webpack/webpack/issues/1114)

## build/config.js

æ–‡ä»¶å†…å®¹æ˜¯æ‰“åŒ…é…ç½®çš„å…¬ç”¨é…ç½®ã€‚

![carbon (40).png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3bc6f626563436bbce2043a7d0fa726\~tplv-k3u1fbpfcp-watermark.image)

**å¤–éƒ¨æ‰©å±•(externals)** ä»è¾“å‡ºçš„ bundle ä¸­æ’é™¤ä¾èµ–,åœ¨è¿è¡Œæ—¶(runtime)ä»å¤–éƒ¨è·å–è¿™äº›æ‰©å±•ä¾èµ–(external dependencies),ä¸»è¦è§£å†³ç»„ä»¶ä¾èµ–å¯¼è‡´ä»£ç å†—ä½™é—®é¢˜ã€‚å…¶ä¸­ `exports.externals = externals;` å†…å®¹æ ¼å¼å¦‚ä¸‹ ğŸ‘‡ã€‚

![carbon (41).png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c501fd42a6041f4a85f772119dc766b\~tplv-k3u1fbpfcp-watermark.image)

## build/webpack.common.js

ä»¥ `commonjs2` è§„èŒƒæ‰“åŒ…æ„å»ºç±»åº“ã€‚

* è°ƒç”¨å‘½ä»¤ï¼š`webpack --config build/webpack.common.js`ã€‚
* å…¥å£æ–‡ä»¶ï¼š`src/index.js`ã€‚
* è¾“å‡ºæ–‡ä»¶ï¼šä»¥`commonjs2`è§„èŒƒæ„å»ºè¾“å‡ºåˆ°`lib/element-ui.common.js`ï¼ˆç±»åº“ä¸»å…¥å£æ–‡ä»¶ï¼‰ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/612da87133b9430085bcafbe20b385b8\~tplv-k3u1fbpfcp-watermark.image)

## build/webpack.component.js

ä»¥ `commonjs2` è§„èŒƒå¯¹æ¯ä¸ªç»„ä»¶å•ç‹¬æ‰“åŒ…æ„å»ºï¼Œæ”¯æŒæŒ‰éœ€å¼•å…¥ã€‚

* è°ƒç”¨å‘½ä»¤ï¼š`webpack --config build/webpack.component.js`ã€‚
* å…¥å£æ–‡ä»¶ï¼š`components.json`ä¸­çš„ç»„ä»¶åˆ—è¡¨ã€‚
* è¾“å‡ºæ–‡ä»¶ï¼šæŠŠ`packages`ç›®å½•ä¸‹çš„ç»„ä»¶ï¼Œä»¥`commonjs2`è§„èŒƒå•ç‹¬æ„å»ºè¾“å‡ºåˆ°`lib/components-name.js`ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/602333ddab9749dba68587da0ebf70f4\~tplv-k3u1fbpfcp-watermark.image)

## build/webpack.conf.js

ä»¥ `umd` è§„èŒƒæ‰“åŒ…æ„å»ºç±»åº“,ä¸ä»…å¯ä»¥ NodeJs ç¯å¢ƒä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ç¯å¢ƒï¼ˆbrowserï¼‰ä½¿ç”¨ï¼Œéœ€è¦è®¾ç½®`umdNamedDefine: true`ã€‚

* è°ƒç”¨å‘½ä»¤ï¼š`webpack --config build/webpack.conf.js`ã€‚
* å…¥å£æ–‡ä»¶ï¼š`src/index.js`ã€‚
* è¾“å‡ºæ–‡ä»¶ï¼šä»¥`umd`è§„èŒƒæ„å»ºè¾“å‡ºåˆ°`lib/index.js`ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6a1f63d887b47f1972302128c4b8b01\~tplv-k3u1fbpfcp-watermark.image)

### externals é…ç½®

é€šè¿‡è¿™ç§æ–¹å¼å¼•å…¥çš„ä¾èµ–åº“ï¼Œä¸ä¼šæ‰“åŒ…åˆ° bundle ä¸­ã€‚ä»¥ä¸‹ä»»ä½•ä¸€ç§å½¢å¼åœ¨å„ç§æ¨¡å—ä¸Šä¸‹æ–‡ä½¿ç”¨ï¼š

* `root`ï¼šå¯ä»¥é€šè¿‡ä¸€ä¸ªå…¨å±€å˜é‡è®¿é—® libraryï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ script æ ‡ç­¾ï¼‰ã€‚
* `commonjs`ï¼šå¯ä»¥å°† library ä½œä¸ºä¸€ä¸ª CommonJS æ¨¡å—è®¿é—®ã€‚
* `commonjs2`ï¼šå’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œä½†å¯¼å‡ºçš„æ˜¯ module.exports.defaultã€‚
* `amd`ï¼šç±»ä¼¼äº commonjsï¼Œä½†ä½¿ç”¨ AMD æ¨¡å—ç³»ç»Ÿã€‚

ä¸€ä¸ªå½¢å¦‚ `{ root, amd, commonjs, ... }` çš„å¯¹è±¡ä»…å…è®¸ç”¨ `libraryTarget: 'umd'` è¿™æ ·çš„é…ç½®.

```json
  // é˜²æ­¢å°†æŸäº› import çš„åŒ…(package)æ‰“åŒ…åˆ° bundle ä¸­ï¼Œ
  // åœ¨è¿è¡Œæ—¶(runtime)å†å»ä»å¤–éƒ¨è·å–è¿™äº›æ‰©å±•ä¾èµ–
  externals: {
    // config.vue
    // {
    //   root: 'Vue',
    //   commonjs: 'vue',
    //   commonjs2: 'vue',
    //   amd: 'vue'
    // }
    vue: config.vue
  },
```

ç”Ÿæˆ`lib\index.js`ä¸­ï¼Œä¾èµ–åº“`vue`å¼•å…¥å£°æ˜ä»£ç å¦‚ä¸‹ï¼š

```js
(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === "object" && typeof module === "object")
    module.exports = factory(require("vue"));
  else if (typeof define === "function" && define.amd)
    define("ELEMENT", ["vue"], factory);
  else if (typeof exports === "object")
    exports["ELEMENT"] = factory(require("vue"));
  else root["ELEMENT"] = factory(root["Vue"]);
});
```

## build/webpack.demo.js

æä¾›äº†ä¸¤å¥—æ‰“åŒ…é…ç½®ï¼Œç”Ÿäº§æ¨¡å¼ç”¨äºé¡¹ç›®ç½‘ç«™çš„æ„å»ºï¼Œå¼€å‘æ¨¡å¼ç”¨äºç»„ä»¶å±•ç¤ºæµ‹è¯•çš„æ„å»ºã€‚ä½¿ç”¨äº† CSSã€JS æ„å»ºçš„ä¼˜åŒ–æ’ä»¶ï¼Œè¿˜é…ç½® `splitChunks`æŠ½å–å…¬å…±æ¨¡å—è§£å†³é‡å¤å¼•å…¥ç¬¬ä¸‰æ–¹åº“çš„é—®é¢˜ã€‚

`npm run deploy:build` å‘½ä»¤æ‰“åŒ…æ„å»ºé¡¹ç›®ç½‘ç«™ã€‚

* è°ƒç”¨å‘½ä»¤ï¼š`webpack --config build/webpack.demo.js`ã€‚
* æ¨¡å¼ï¼š`production`ã€‚
* å…¥å£æ–‡ä»¶ï¼š`examples/entry.js`ã€‚
* è¾“å‡ºæ–‡ä»¶ï¼šæ„å»ºå†…å®¹è¾“å‡ºè‡³`examples/element-ui/`ç›®å½•ä¸‹ã€‚

`npm run deploy:build` å‘½ä»¤æ‰“åŒ…è¿è¡Œé¡¹ç›®ç½‘ç«™ï¼Œç”¨äºå¼€å‘è°ƒè¯•ã€‚

* è°ƒç”¨å‘½ä»¤ï¼š`webpack-dev-server --config build/webpack.demo.js`ã€‚
* æ¨¡å¼ï¼š`development`ã€‚
* å…¥å£æ–‡ä»¶ï¼š`examples/entry.js`ã€‚
* è¾“å‡ºæ–‡ä»¶ï¼šæ„å»ºå†…å®¹è¾“å‡ºè‡³`examples/element-ui/`ç›®å½•ä¸‹ã€‚

`npm run dev:play` å‘½ä»¤ç”¨äºç»„ä»¶åº“å¼€å‘ä¸­çš„åŠŸèƒ½å±•ç¤ºã€‚

* è°ƒç”¨å‘½ä»¤ï¼š`webpack-dev-server --config build/webpack.demo.js`ã€‚
* æ¨¡å¼ï¼š`development`ã€‚
* å…¥å£æ–‡ä»¶ï¼š`examples/entry.js`ã€‚
* è¾“å‡ºæ–‡ä»¶ï¼šæ„å»ºå†…å®¹è¾“å‡ºè‡³`examples/element-ui/`ç›®å½•ä¸‹ã€‚

![carbon (37).png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7f26ca78c784c1b937eaf3d2d06f78c\~tplv-k3u1fbpfcp-watermark.image)

## build/webpack.extension.js

ç”¨äºæ„å»ºåä¸º`Element Theme Roller`çš„ chorme æ’ä»¶é¡¹ç›®ï¼Œå¤ç”¨å¤§éƒ¨åˆ† `webpack.demo.js` æ‰“åŒ…é…ç½®ã€‚`npm run deploy:extension`ç”¨äºé¡¹ç›®ç”Ÿäº§å‘å¸ƒï¼›`npm run dev:extension`ç”¨äºå¼€å‘è°ƒè¯•ã€‚

* è°ƒç”¨å‘½ä»¤ï¼š`webpack --config build/webpack.extension.js`ã€‚
* å…¥å£æ–‡ä»¶ï¼š`examples/extension/src/background.js`å’Œ`examples/extension/src/entry.js`ã€‚
* è¾“å‡ºæ–‡ä»¶ï¼šæ„å»ºå†…å®¹è¾“å‡ºè‡³`examples/extension/dist`ç›®å½•ä¸‹ã€‚ç”Ÿæˆæ–‡ä»¶ `background.js` `entry.js` ,å¤åˆ¶æ–‡ä»¶ `icon.png` `manifest.json` ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6df65cf49575421e9b00266621ae3670\~tplv-k3u1fbpfcp-watermark.image)

## build/webpack.test.js

ç”¨äº `test/unit/karma.conf.js` ä¸­æ‰“åŒ…é…ç½®ã€‚

```js
// test/unit/karma.conf.js
const webpackConfig = require('../../build/webpack.test');

module.exports = function(config) {
  const configuration = {
    ...
    webpack: webpackConfig,
    ...
  };

  config.set(configuration);
};
```

## å…³è”é˜…è¯»

ç‚¹å‡»ä»¥ä¸‹é“¾æ¥ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹æœ¬ç³»åˆ—å…¶ä»–æ–‡ç« ï¼š\
[ä¸“æ /Element 2.X æºç å­¦ä¹ ](https://juejin.cn/column/6961321064110489631)

ğŸ‘‡ é¡¹ç›®å·¥ç¨‹åŒ–ç³»åˆ—æ–‡ç« é“¾æ¥å¦‚ä¸‹ï¼Œæ¨èæŒ‰ç…§é¡ºåºé˜…è¯»æ–‡ç«  ğŸ‘‡ã€‚

1ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šé¡¹ç›®æ¦‚è§ˆã€package.jsonã€npm script](https://juejin.cn/post/6969258163136626725)\
2ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šé¡¹ç›®æ„å»ºã€MD è§£æ](https://juejin.cn/post/6969933702759940133)\
3ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šæ‰“åŒ…é…ç½®](https://juejin.cn/post/6970691644114862111/)\
4ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šå‘å¸ƒéƒ¨ç½²ã€æŒç»­é›†æˆ](https://juejin.cn/post/6971054455139598366/)\
5ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šä¸»é¢˜æ„å»ºã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ä»£ç è´¨é‡æ£€æŸ¥ã€ç±»å‹å£°æ˜](https://juejin.cn/post/6971434343516340238)\
6ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šé¡¹ç›®ç½‘ç«™](https://juejin.cn/post/6972180649625157645)\
7ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šå‘½ä»¤ä¹‹å›¾è§£](https://juejin.cn/post/6991347082552573965)
