# 2.5 Deployment && CI

> åŸæ–‡åœ°å€ï¼š [https://juejin.cn/post/6971054455139598366/](https://juejin.cn/post/6971054455139598366/)

æœ¬æ–‡å°†ä»‹ç»é¡¹ç›®çš„å‘å¸ƒéƒ¨ç½²ã€æŒç»­é›†æˆã€‚

## ğŸš€ å‘å¸ƒéƒ¨ç½²

æ‰§è¡Œå‘½ä»¤ `npm run pub` å®ç°å‘å¸ƒéƒ¨ç½²æµç¨‹ï¼š

* æœ¬åœ°ä»£ç æ£€æŸ¥åˆå¹¶ï¼Œpush åˆ°è¿œç¨‹åˆ†æ”¯ï¼›
* ç»„ä»¶æ„å»ºå‘å¸ƒ(npm pulish)ï¼›
* å®˜ç½‘å‘å¸ƒéƒ¨ç½²ã€‚

æ¥ä¸‹æ¥è¯¦ç»†ä»‹ç»å„ `shell` è„šæœ¬åŠŸèƒ½ã€‚

### build/git-release.sh

æ£€æŸ¥æœ¬åœ°ä»£ç  `dev` åˆ†æ”¯æ˜¯å¦ä¸çº¿ä¸Šåˆ†æ”¯å­˜åœ¨å†²çªã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7c724b7007f49078ba370566bbe42c0\~tplv-k3u1fbpfcp-watermark.image)

### build/release.sh

ä¸»è¦ä½œç”¨ä»£ç åˆ†æ”¯åˆå¹¶ push è¿œç¨‹åˆ†æ”¯ã€ç‰ˆæœ¬å·ç¡®è®¤æ›´æ–°ã€ç»„ä»¶ä¸»é¢˜å‘å¸ƒ(npm pulish)ã€‚

1. åˆå¹¶ dev åˆ†æ”¯åˆ° master
2. é€šè¿‡ `select-version-cli` ç¡®è®¤å‘å¸ƒç‰ˆæœ¬å·ã€‚
3. æ‰§è¡Œå‘½ä»¤ `npm run dist` æ‰“åŒ…æ„å»ºç»„ä»¶ã€‚
4. è¿è¡Œ ssr æµ‹è¯• `node test/ssr/require.test.js`ã€‚
5. å‘å¸ƒä¸»é¢˜ï¼Œæ›´æ–°ç‰ˆæœ¬å·ï¼Œä¸ç»„ä»¶åº“ä¿æŒä¸€è‡´ã€‚
6. æäº¤ä»£ç å¹¶æ›´æ–° package.json ä¸­çš„ç‰ˆæœ¬å· ã€‚
7. master å’Œ dev åˆ†æ”¯ push åˆ°è¿œç¨‹åˆ†æ”¯ã€‚
8. å‘å¸ƒç»„ä»¶ã€‚

![carbon (92).png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59550d03381d46e8ba5841bf6bc5da2c\~tplv-k3u1fbpfcp-watermark.image)

`select-version-cli` æä¾›é€‰æ‹©å‘å¸ƒç‰ˆæœ¬é€‰æ‹©ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4feea1adb27445b082e11842e06884ce\~tplv-k3u1fbpfcp-watermark.image)

é€‰æ‹©ç¡®è®¤åï¼Œç»§ç»­æ‰§è¡Œ `release.sh` æ‰§è¡Œå‘å¸ƒéƒ¨ç½²æµç¨‹ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c1797177ab347db9385a94bab55b9cd\~tplv-k3u1fbpfcp-watermark.image)

### ğŸš§ build/deploy-faas.sh

ç½‘ç«™å‘å¸ƒéƒ¨ç½²ï¼Œ ç”¨äº`faas deploy` é…ç½®ã€‚åœ¨ 2.15 ç‰ˆæœ¬ä¹‹åç§»é™¤äº†`pub`å‘½ä»¤ `sh build/deploy-faas.sh`è°ƒç”¨ï¼Œé›†æˆè‡³ CIï¼Œè¯¦è§`build/deploy-ci.sh`ã€‚

![carbon (93).png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7a7413a978c41a4b48e43dfacf2434d\~tplv-k3u1fbpfcp-watermark.image)

## æŒç»­é›†æˆ

æŒç»­é›†æˆï¼ˆContinuous Integrationï¼Œç®€ç§° CIï¼‰æŒ‡çš„æ˜¯åªè¦ä»£ç æœ‰å˜æ›´ï¼Œå°±è‡ªåŠ¨è¿è¡Œæ„å»ºå’Œæµ‹è¯•ï¼Œåé¦ˆè¿è¡Œç»“æœã€‚ç¡®ä¿ç¬¦åˆé¢„æœŸä»¥åï¼Œå†å°†æ–°ä»£ç "é›†æˆ"åˆ°ä¸»å¹²ã€‚æŒç»­é›†æˆçš„å¥½å¤„åœ¨äºï¼Œæ¯æ¬¡ä»£ç çš„å°å¹…å˜æ›´ï¼Œå°±èƒ½çœ‹åˆ°è¿è¡Œç»“æœï¼Œä»è€Œä¸æ–­ç´¯ç§¯å°çš„å˜æ›´ï¼Œè€Œä¸æ˜¯åœ¨å¼€å‘å‘¨æœŸç»“æŸæ—¶ï¼Œä¸€ä¸‹å­åˆå¹¶ä¸€å¤§å—ä»£ç ã€‚

### .travis.yml

ä½¿ç”¨ Travis CI æä¾›çš„æ˜¯æŒç»­é›†æˆæœåŠ¡ï¼Œé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é¢å¿…é¡»æœ‰ä¸€ä¸ª.travis.yml æ–‡ä»¶ã€‚è¿™æ˜¯é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šäº† Travis çš„è¡Œä¸ºã€‚è¯¥æ–‡ä»¶å¿…é¡»ä¿å­˜åœ¨ Github ä»“åº“é‡Œé¢ï¼Œä¸€æ—¦ä»£ç ä»“åº“æœ‰æ–°çš„ Commitï¼ŒTravis å°±ä¼šå»æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰§è¡Œé‡Œé¢çš„å‘½ä»¤(æ‰§è¡Œæµ‹è¯•ã€æ„å»ºã€éƒ¨ç½²ç­‰æ“ä½œ)ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cba5805cc37418d80f99c6e11f50137\~tplv-k3u1fbpfcp-watermark.image)

### build/deploy-ci.sh

ä¸»è¦ä½œç”¨æ„å»ºå‘è¡Œç‰ˆæœ¬å’Œå¼€å‘ç‰ˆæœ¬å†…å®¹ã€‚

1. git config å®šä¹‰ user.name å’Œ user.emailã€‚
2. å‘è¡Œç‰ˆæœ¬æ„å»º(ç»„ä»¶åº“ã€ä¸»é¢˜`theme-chalk`ã€é¡¹ç›®ç½‘ç«™)ã€æ‰“æ–°æ ‡ç­¾ã€‚
3. å¼€å‘åˆ†æ”¯çš„ ä¸»é¢˜`theme-chalk`ã€é¡¹ç›®ç½‘æ„å»ºæäº¤åˆ° master åˆ†æ”¯ã€‚

![carbon (43).png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8cd2483135e64096b50956e6e1e4983c\~tplv-k3u1fbpfcp-watermark.image)

## makefile

`makefile`å¸¦æ¥çš„å¥½å¤„å°±æ˜¯**è‡ªåŠ¨åŒ–æ„å»º**ï¼Œä¸€æ—¦å†™å¥½ï¼Œåªéœ€è¦ä¸€ä¸ª`make`å‘½ä»¤ï¼Œæ•´ä¸ªå·¥ç¨‹å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæå¤§çš„æé«˜äº†è½¯ä»¶å¼€å‘çš„æ•ˆç‡ã€‚

> åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œ`make` æ˜¯ä¸€ä¸ªå·¥å…·ç¨‹åºï¼ˆUtility softwareï¼‰ï¼Œç»ç”±è¯»å–å«åš `makefile` çš„æ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ–å»ºæ„è½¯ä»¶ã€‚å®ƒæ˜¯ä¸€ç§è½¬åŒ–æ–‡ä»¶å½¢å¼çš„å·¥å…·ï¼Œè½¬æ¢çš„ç›®æ ‡ç§°ä¸º `target` ï¼›ä¸æ­¤åŒæ—¶ï¼Œå®ƒä¹Ÿæ£€æŸ¥æ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œå®ƒä¼šè°ƒç”¨ä¸€äº›å¤–éƒ¨è½¯ä»¶æ¥å®Œæˆä»»åŠ¡ã€‚å®ƒä½¿ç”¨å«åš `makefile` çš„æ–‡ä»¶æ¥ç¡®å®šä¸€ä¸ª `target` æ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œç„¶åæŠŠç”Ÿæˆè¿™ä¸ª `target` çš„ç›¸å…³å‘½ä»¤ä¼ ç»™ `shell` å»æ‰§è¡Œã€‚

mac/linux ä¸­ç›´æ¥å¯ä»¥æ‰§è¡Œ make å‘½ä»¤çš„(terminal bash)ã€‚ Windows ä¸‹è½½ make çš„ GUN å·¥å…·[Make for Windows](http://gnuwin32.sourceforge.net/packages/make.htm)

> **é…ç½®ç¯å¢ƒå˜é‡ Win**
>
> å³é”®`æˆ‘çš„ç”µè„‘`->`å±æ€§`->`é«˜çº§`->`ç¯å¢ƒå˜é‡`->`ç³»ç»Ÿå˜é‡`->`å˜é‡path`,ç„¶ååœ¨`path`ä¸­æ–°å»ºç¯å¢ƒå˜é‡ï¼Œç›®å½•å®šä½åˆ°`make for windows`å®‰è£…ç›®å½•(é»˜è®¤è·¯å¾„ C:\Program Files (x86)\GnuWin32\bin\ )å³å¯ã€‚

è‹¥ç›®å½•ä¸‹æ²¡æœ‰ `makefile`,æ‰§è¡Œæ˜¾ç¤ºâ€œæ²¡æœ‰æŒ‡æ˜ç›®æ ‡å¹¶ä¸”æ‰¾ä¸åˆ° makefile â€ï¼Œç»ˆæ­¢å‘½ä»¤ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/674486e5d7664c2482f60e29efdc1083\~tplv-k3u1fbpfcp-watermark.image)

æ‰§è¡Œ `make` å‘½ä»¤å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/915ae59a64a64132a29145c7e14843f0\~tplv-k3u1fbpfcp-watermark.image)

æ‰§è¡Œ `make target` å‘½ä»¤åï¼Œæ‰¾åˆ° `target` å¯¹åº”çš„ `commonds`å¹¶æ‰§è¡Œã€‚ æŸ¥çœ‹æºæ–‡ä»¶,æ¯ä¸ª`commonds`éƒ½æ˜¯ npm scriptï¼Œå…·ä½“åŠŸèƒ½è¯¦è§å‰æ–‡ã€‚(make help è¾“å‡ºæ–‡æœ¬å­˜åœ¨è½¬ä¹‰å­—ç¬¦ï¼Œwin ç³»ç»Ÿæ— æ³•æ”¯æŒ)

![carbon (44).png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/797f044c9b834682827409b7633a9a14\~tplv-k3u1fbpfcp-watermark.image)

## å…³è”é˜…è¯»

ç‚¹å‡»ä»¥ä¸‹é“¾æ¥ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹æœ¬ç³»åˆ—å…¶ä»–æ–‡ç« ï¼š\
[ä¸“æ /Element 2.X æºç å­¦ä¹ ](https://juejin.cn/column/6961321064110489631)

ğŸ‘‡ é¡¹ç›®å·¥ç¨‹åŒ–ç³»åˆ—æ–‡ç« é“¾æ¥å¦‚ä¸‹ï¼Œæ¨èæŒ‰ç…§é¡ºåºé˜…è¯»æ–‡ç«  ğŸ‘‡ã€‚

1ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šé¡¹ç›®æ¦‚è§ˆã€package.jsonã€npm script](https://juejin.cn/post/6969258163136626725)\
2ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šé¡¹ç›®æ„å»ºã€MD è§£æ](https://juejin.cn/post/6969933702759940133)\
3ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šæ‰“åŒ…é…ç½®](https://juejin.cn/post/6970691644114862111/)\
4ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šå‘å¸ƒéƒ¨ç½²ã€æŒç»­é›†æˆ](https://juejin.cn/post/6971054455139598366/)\
5ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šä¸»é¢˜æ„å»ºã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ä»£ç è´¨é‡æ£€æŸ¥ã€ç±»å‹å£°æ˜](https://juejin.cn/post/6971434343516340238)\
6ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šé¡¹ç›®ç½‘ç«™](https://juejin.cn/post/6972180649625157645)\
7ï¸âƒ£ [æºç å‰–æä¹‹å·¥ç¨‹åŒ–ï¼šå‘½ä»¤ä¹‹å›¾è§£](https://juejin.cn/post/6991347082552573965)
